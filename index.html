<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üï∑Ô∏è Marvel Comics Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #334155 25%, #1e293b 75%, #475569 100%);
            color: #e2e8f0;
            min-height: 100vh;
            line-height: 1.3;
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #f59e0b;
            padding: 10px 20px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .tabs {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            background: rgba(51, 65, 85, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid #475569;
            padding: 0 20px;
            z-index: 999;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .tab-buttons {
            display: flex;
            gap: 2px;
            overflow-x: auto;
            position: relative;
        }

        .tab-button {
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
            z-index: 1;
        }

        .tab-button:hover {
            color: #f1f5f9;
            background: rgba(71, 85, 105, 0.5);
        }

        .tab-button.active {
            color: #f59e0b;
            border-bottom-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .tab-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: #f59e0b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 2px 2px 0 0;
        }

        .main-content {
            margin-top: 124px;
            padding: 20px;
            min-height: calc(100vh - 135px);
            position: relative;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #475569, #334155);
            color: white;
            border: 1px solid #64748b;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #64748b, #475569);
            transform: translateY(-2px);
        }

        .search-box, .sort-select {
            background: rgba(51, 65, 85, 0.8);
            border: 2px solid #64748b;
            border-radius: 12px;
            padding: 12px 16px;
            color: #e2e8f0;
            font-size: 14px;
            width: 250px;
            transition: all 0.3s ease;
            appearance: none;
        }

        .sort-select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23cbd5e1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .search-box:focus, .sort-select:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .view-toggle {
            display: flex;
            background: rgba(71, 85, 105, 0.8);
            border-radius: 12px;
            overflow: hidden;
        }

        .view-toggle button {
            padding: 10px 15px;
            border: none;
            background: transparent;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #f59e0b;
            color: white;
        }

        .comics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .comics-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .comic-card {
            background: rgba(51, 65, 85, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #475569;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .comic-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border-color: #94a3b8;
        }

        .comic-image {
            width: 100%;
            height: 260px;
            object-fit: cover;
            background: linear-gradient(135deg, #475569, #64748b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 48px;
            position: relative;
        }

        .comic-info {
            padding: 15px;
        }

        .comic-title {
            font-size: 14px;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 8px;
        }

        .comic-content {
            font-size: 12px;
            color: #cbd5e1;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .comic-years {
            font-size: 12px;
            font-weight: 600;
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            padding: 4px 8px;
            border-radius: 8px;
            display: inline-block;
        }

        .progress-indicator {
            margin-top: 10px;
            background: rgba(71, 85, 105, 0.8);
            border-radius: 8px;
            padding: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(100, 116, 139, 0.5);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .progress-bar:hover {
            height: 12px;
            margin-bottom: 2px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 11px;
            color: #cbd5e1;
            text-align: center;
        }

        .comic-list-item {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #475569;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .comic-list-item:hover {
            background: rgba(71, 85, 105, 0.8);
            border-color: #94a3b8;
            transform: translateY(-2px);
        }

        .comic-list-image {
            width: 80px;
            height: 120px;
            border-radius: 8px;
            object-fit: cover;
            background: linear-gradient(135deg, #475569, #64748b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 32px;
            flex-shrink: 0;
        }

        .comic-list-info {
            flex: 1;
        }

        .reading-list-item {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #475569;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            cursor: grab;
        }

        .reading-list-item:hover {
            border-color: #94a3b8;
            transform: translateX(5px);
        }

        .reading-list-item.read {
            opacity: 0.6;
            background: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
        }

        .reading-list-item.dragging {
            opacity: 0.5;
            transform: rotate(3deg) scale(1.02);
            z-index: 1000;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .reading-list-image {
            width: 90px;
            height: 130px;
            border-radius: 8px;
            object-fit: cover;
            background: linear-gradient(135deg, #475569, #64748b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 36px;
            flex-shrink: 0;
        }

        .reading-list-comic-info {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .reading-list-text-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .reading-list-main-info {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .reading-list-title-text {
            font-weight: 700;
            color: #f1f5f9;
            font-size: 18px;
            background: rgba(71, 85, 105, 0.6);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #64748b;
        }

        .reading-list-content-text {
            font-size: 14px;
            color: #cbd5e1;
            line-height: 1.4;
            background: rgba(71, 85, 105, 0.6);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #64748b;
        }

        .reading-list-years {
            font-size: 14px;
            font-weight: 600;
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #f59e0b;
            display: inline-block;
        }

        .reading-list-progress {
            margin-top: 8px;
        }

        .reading-list-progress-blocks {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            margin-bottom: 10px;
        }

        .progress-block {
            min-width: 32px;
            height: 32px;
            border: 1px solid #64748b;
            border-radius: 6px;
            background: rgba(100, 116, 139, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            padding: 0 6px;
            flex-shrink: 0;
        }

        .progress-block:hover {
            border-color: #94a3b8;
            background: rgba(148, 163, 184, 0.2);
            transform: scale(1.05);
        }

        .progress-block.read {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-color: #22c55e;
            color: white;
        }

        .reading-list-progress-text {
            font-size: 12px;
            color: #cbd5e1;
            text-align: left;
        }

        .reading-list-grid-view {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .reading-list-grid-item {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #475569;
            transition: all 0.3s ease;
            position: relative;
            cursor: grab;
        }

        .reading-list-grid-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .reading-list-grid-item.dragging {
            opacity: 0.6;
            transform: rotate(5deg) scale(1.05);
            z-index: 1000;
        }

        .reading-list-grid-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background: linear-gradient(135deg, #475569, #64748b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            font-size: 48px;
        }

        .reading-list-grid-info {
            padding: 15px;
        }

        .reading-list-grid-title {
            font-weight: 700;
            color: #f1f5f9;
            font-size: 14px;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .reading-list-grid-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .reading-list-grid-years {
            font-size: 12px;
            font-weight: 600;
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #f59e0b;
        }

        .reading-list-grid-content {
            font-size: 12px;
            color: #cbd5e1;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .reading-list-grid-progress {
            margin-top: 10px;
        }

        .reading-list-grid-progress .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(100, 116, 139, 0.5);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reading-list-grid-progress .progress-bar:hover {
            height: 8px;
        }

        .reading-list-grid-progress .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22c55e, #16a34a);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .reading-list-grid-progress .progress-text {
            font-size: 11px;
            color: #cbd5e1;
            text-align: center;
        }

        .reading-list-order-arrow {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(245, 158, 11, 0.9);
            color: black;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .reading-list-view-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .reading-list-view-toggle {
            display: flex;
            background: rgba(71, 85, 105, 0.8);
            border-radius: 12px;
            overflow: hidden;
        }

        .reading-list-view-toggle button {
            padding: 10px 15px;
            border: none;
            background: transparent;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reading-list-view-toggle button.active {
            background: #f59e0b;
            color: white;
        }

        .comic-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .comic-card:hover .comic-actions,
		.comic-list-item:hover .comic-actions,
		.reading-list-item:hover .comic-actions,
		.reading-list-grid-item:hover .comic-actions {
			opacity: 1;
		}

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .edit-btn {
            background: linear-gradient(135deg, #f59e0b, #f97316);
        }

        .delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .read-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
		
		.copy-btn {
			background: linear-gradient(135deg, #8b5cf6, #7c3aed);
		}

        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1100;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(51, 65, 85, 0.95);
            backdrop-filter: blur(20px);
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #64748b;
            max-width: 1000px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            max-height: 100vh;
            overflow-y: auto;
        }

        .modal h3 {
            margin-bottom: 25px;
            color: #f59e0b;
            font-size: 24px;
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            background: rgba(71, 85, 105, 0.8);
            border: 2px solid #64748b;
            border-radius: 12px;
            padding: 14px 16px;
            color: #f1f5f9;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .reading-lists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .reading-list-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(71, 85, 105, 0.6);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #64748b;
            transition: all 0.3s ease;
        }

        .reading-list-checkbox:hover {
            border-color: #94a3b8;
        }

        .reading-list-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin: 0;
            appearance: none;
            background: rgba(71, 85, 105, 0.8);
            border: 2px solid #64748b;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .reading-list-checkbox input[type="checkbox"]:checked {
            background: #f59e0b;
            border-color: #f59e0b;
        }

        .reading-list-checkbox input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .progress-slider-group {
            margin-top: 15px;
        }

        .progress-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(100, 116, 139, 0.5);
            outline: none;
            margin: 10px 0;
        }

        .progress-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.4);
        }

        .progress-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(245, 158, 11, 0.4);
        }

        .progress-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 10px;
        }

        .progress-inputs input {
            width: 80px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #94a3b8;
            background: rgba(51, 65, 85, 0.4);
            border-radius: 20px;
            border: 2px dashed #64748b;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 15px;
            color: #cbd5e1;
        }

        .reading-lists-grid-page {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .reading-list-card {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #475569;
            transition: all 0.3s ease;
            position: relative;
            cursor: pointer;
        }

        .reading-list-card:hover {
            border-color: #94a3b8;
            transform: translateY(-2px);
        }

        .reading-list-card.active {
            border-color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }
		
		.reading-list-card.dragging {
			opacity: 0.5;
			transform: rotate(2deg) scale(1.02);
			z-index: 1000;
			box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
		}

		.reading-list-card.drag-over {
			border-color: #f59e0b !important;
			background: rgba(245, 158, 11, 0.2) !important;
			transform: translateY(-4px) !important;
		}

        .reading-list-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 8px;
        }

        .reading-list-card-meta {
            font-size: 12px;
            color: #cbd5e1;
        }

        .reading-list-card-actions {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .reading-list-card:hover .reading-list-card-actions {
            opacity: 1;
        }

        .expand-icon {
            transition: transform 0.3s ease;
            color: #cbd5e1;
        }

        .reading-list-card.active .expand-icon {
            transform: rotate(180deg);
        }

        .reading-list-content {
            display: none;
            border: 1px solid #475569;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: rgba(30, 41, 59, 0.5);
            min-height: 150px;
        }

        .reading-list-content.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(51, 65, 85, 0.8);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #475569;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: #94a3b8;
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #cbd5e1;
            font-size: 14px;
        }

        .list-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .list-input-group input {
            flex: 1;
            max-width: 400px;
            background: rgba(71, 85, 105, 0.8);
            border: 2px solid #64748b;
            border-radius: 12px;
            padding: 12px 16px;
            color: #f1f5f9;
        }

        .list-input-group input:focus {
            outline: none;
            border-color: #f59e0b;
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }

        .drag-over {
            border-color: #f59e0b !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }

        .scroll-buttons {
            position: fixed;
            right: 20px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .scroll-buttons.visible {
            opacity: 1;
            visibility: visible;
        }

        .add-comic-btn {
            position: fixed;
            bottom: 20px;
            right: 90px;
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            cursor: pointer;
            font-size: 28px;
            font-weight: 300;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-comic-btn:hover {
            transform: translateY(-2px) scale(1.1);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }

        .scroll-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #f59e0b, #f97316);
            color: white;
            cursor: pointer;
            font-size: 20px;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .drag-handle {
            color: #94a3b8;
            font-size: 18px;
            cursor: grab;
            padding: 10px;
            align-self: flex-start;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
                padding: 15px 20px;
            }
            .main-content {
                padding: 15px;
                margin-top: 155px;
            }
            .content-header {
                flex-direction: column;
                align-items: stretch;
            }
            .controls {
                justify-content: center;
            }
            .comics-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 15px;
            }
            .search-box, .sort-select {
                width: 100%;
            }
            .reading-lists-grid {
                grid-template-columns: 1fr;
            }
            .reading-lists-grid-page {
                grid-template-columns: 1fr;
            }
            .reading-list-comic-info {
                flex-direction: row;
                gap: 10px;
            }
            .reading-list-image {
                width: 70px;
                height: 110px;
                align-self: flex-start;
                border-radius: 8px;
            }
            .reading-list-title-text, .reading-list-years, .reading-list-content-text {
                margin-bottom: 4px;
            }
            .reading-list-text-info {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            .reading-list-progress-blocks {
                display: none;
            }
            .reading-list-progress-blocks.mobile-expanded {
                display: flex;
                flex-wrap: wrap;
                gap: 2px;
                margin-bottom: 10px;
            }
            .reading-list-grid-view {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 12px;
            }
            .reading-list-grid-image {
                height: 140px;
                font-size: 32px;
            }
            .reading-list-mode-toggle, .reading-list-card-actions button[title^="–û—Ç–∫—Ä—ã—Ç—å –∫–∞–∫"] {
                display: none !important;
            }
            .reading-list-card-meta {
                font-size: 13px;
            }
            .reading-list-card {
                padding: 12px;
            }
            .reading-list-card-title {
                font-size: 15px;
            }
            .reading-list-content {
                padding: 10px;
            }
            .reading-list-view-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            .reading-list-view-controls h3 {
                order: -1;
                font-size: 18px;
                margin-bottom: 0;
            }
            .reading-list-sort-toggle, .reading-list-view-toggle {
                margin-bottom: 0;
            }
            .reading-list-view-controls .btn[title="–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ TXT"] {
                display: none !important;
            }
            .reading-list-list-item {
                flex-direction: row;
            }
            .reading-list-content-text {
                font-size: 13px;
            }
            .reading-list-progress {
                margin-top: 4px;
            }
            .reading-list-card-actions {
                gap: 2px;
            }
            .reading-list-card {
                margin-bottom: 8px;
            }
            .reading-lists-toggle-btn {
                display: flex !important;
                align-items: center;
                justify-content: flex-start;
                background: rgba(71, 85, 105, 0.8);
                border: 1px solid #475569;
                border-radius: 10px;
                padding: 8px 14px;
                font-size: 16px;
                color: #f1f5f9;
                margin-bottom: 10px;
                cursor: pointer;
                width: 100%;
            }
            .reading-lists-grid-page {
                display: none;
            }
            .reading-lists-grid-page.mobile-visible {
                display: grid;
                margin-bottom: 10px;
            }
            .tabs {
                position: sticky;
                top: 0;
                left: 0;
                right: 0;
                z-index: auto;
                background: rgba(51, 65, 85, 0.95);
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                margin-bottom: 0;
                padding: 0 0;
                display: block !important;
            }
            .tab-buttons {
                display: flex !important;
                gap: 0;
                width: 100%;
            }
            .tab-button {
                flex: 1 1 0;
                min-width: 0;
                font-size: 15px;
                padding: 12px 0;
                border-bottom: none;
                background: transparent;
                color: #cbd5e1;
                font-weight: 600;
                border-radius: 0;
            }
            .tab-indicator {
                display: none;
            }
            .tab-button.active {
                color: #f59e0b;
                background: rgba(245, 158, 11, 0.1);
            }
            .reading-lists-toggle-btn {
                display: flex !important;
                align-items: center;
                justify-content: flex-start;
                background: rgba(71, 85, 105, 0.8);
                border: 1px solid #475569;
                border-radius: 10px;
                padding: 8px 14px;
                font-size: 16px;
                color: #f1f5f9;
                margin-bottom: 10px;
                margin-top: 0;
                cursor: pointer;
                width: 100%;
            }
            .reading-lists-toggle-btn.mobile-top {
                margin-top: 10px;
                margin-bottom: 10px;
            }
            .reading-list-view-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }
            .reading-list-view-controls h3 {
                order: -1;
                font-size: 18px;
                margin-bottom: 0;
            }
            .reading-list-sort-toggle, .reading-list-view-toggle {
                display: flex !important;
                flex-direction: row;
                gap: 8px;
                width: 100%;
                margin-top: 6px;
                margin-bottom: 6px;
            }
            .reading-list-sort-toggle button, .reading-list-view-toggle button {
                flex: 1 1 0;
                width: 100%;
                min-width: 0;
                font-size: 14px;
                padding: 10px 0;
                border-radius: 8px !important;
                margin: 0 !important;
            }
            .reading-list-sort-toggle, .reading-list-view-toggle {
                margin-bottom: 0;
            }
            .reading-list-view-controls .btn[title="–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ TXT"] {
                display: none !important;
            }
            .reading-list-progress-blocks .btn-secondary, .reading-list-progress-blocks .btn-secondary.mobile-progress-toggle {
                display: block !important;
                width: 100%;
                margin: 8px 0 8px 0;
                font-size: 15px;
                padding: 10px 0;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–æ–∫ –≤ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ –∫–æ–º–∏–∫—Å–æ–≤ */
        .comic-content a,
        .reading-list-content-text a,
        .reading-list-grid-content a {
            color: #87CEEB; /* –±–ª–µ–¥–Ω–æ-–≥–æ–ª—É–±–æ–π */
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .comic-content a:hover,
        .reading-list-content-text a:hover,
        .reading-list-grid-content a:hover {
            color: #B0E0E6; /* –±–æ–ª–µ–µ —Å–≤–µ—Ç–ª—ã–π –≥–æ–ª—É–±–æ–π –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
            text-decoration: underline;
        }

        /* --- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–æ—Å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤ --- */
        .reading-list-double-col {
            scrollbar-width: thin;
            scrollbar-color: #64748b #1e293b;
        }
        .reading-list-double-col::-webkit-scrollbar {
            width: 8px;
            background: #1e293b;
            border-radius: 8px;
        }
        .reading-list-double-col::-webkit-scrollbar-thumb {
            background: #64748b;
            border-radius: 8px;
            min-height: 40px;
        }
        .reading-list-double-col::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* --- –£–±—Ä–∞—Ç—å –ª—é–±—É—é —Ä–∞–º–∫—É/–æ–±–≤–æ–¥–∫—É —É –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ —Ä–µ–∂–∏–º–µ –¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤ --- */
        .reading-list-content[style*="border"] {
            border: none !important;
            box-shadow: none !important;
        }

        /* --- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è 1/2 –∫–∞–∫ —É –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è –≤–∏–¥–∞ --- */
        .reading-list-mode-toggle {
            display: flex;
            background: rgba(71, 85, 105, 0.8);
            border-radius: 12px;
            overflow: hidden;
            height: 37px;
            margin-right: 0;
        }
        .reading-list-mode-toggle button {
            padding: 10px 15px;
            border: none;
            background: transparent;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            border-radius: 0;
            height: 37px;
            width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .reading-list-mode-toggle button.active {
            background: #f59e0b;
            color: white;
        }
        .reading-list-mode-toggle button:first-child {
            border-radius: 12px 0 0 12px;
        }
        .reading-list-mode-toggle button:last-child {
            border-radius: 0 12px 12px 0;
        }
        .reading-list-mode-toggle button:not(:last-child) {
            border-right: 1px solid #475569;
        }
        .reading-list-sort-toggle button.active {
            background: #f59e0b;
            color: white;
        }

        /* --- –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤ —Å–ø–∏—Å–∫–µ --- */
        .reading-list-sort-toggle {
            display: flex;
            background: rgba(71, 85, 105, 0.8);
            border-radius: 12px;
            overflow: hidden;
            height: 38px;
            margin: 0 10px;
        }
        .reading-list-sort-toggle button {
            padding: 10px 15px;
            border: none;
            background: transparent;
            color: #cbd5e1;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            border-radius: 0;
            height: 38px;
            width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }
        .reading-list-sort-toggle button.active {
            background: #f59e0b;
            color: white;
        }
        .reading-list-sort-toggle button:first-child {
            border-radius: 12px 0 0 12px;
        }
        .reading-list-sort-toggle button:last-child {
            border-radius: 0 12px 12px 0;
        }
        .reading-list-sort-toggle button:not(:last-child) {
            border-right: 1px solid #475569;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBrlOVpLyaQC-j35jKI6dpUROeJ4Q2dXaU",
        authDomain: "igatrackers.firebaseapp.com",
        projectId: "igatrackers",
        storageBucket: "igatrackers.appspot.com",
        messagingSenderId: "629727578641",
        appId: "1:629727578641:web:c85bd10081c56e0e283fb0",
        measurementId: "G-MZ6W6B5MTX"
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();
    </script>
</head>
<body>
    <div class="header">
        <h1>üï∑Ô∏è Marvel Comics Tracker</h1>
        <div class="header-right">
            <button class="btn btn-secondary" onclick="exportData()" title="–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö">üì§</button>
            <button class="btn btn-secondary" onclick="importData()" title="–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö">üì•</button>
            <div id="authSection" style="display:inline-block; margin-left:10px;">
                <button id="loginBtn" class="btn btn-secondary" onclick="loginWithGoogle()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
                <button id="logoutBtn" class="btn btn-secondary" onclick="logout()" style="display:none;">–í—ã–π—Ç–∏</button>
                <span id="userName" style="margin-left:10px;"></span>
            </div>
        </div>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
    </div>

    <div class="tabs">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab('reading-lists')">üìñ –°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è</button>
            <button class="tab-button" onclick="switchTab('collection')">üìö –ö–æ–ª–ª–µ–∫—Ü–∏—è</button>
            <div class="tab-indicator"></div>
        </div>
    </div>

    <div class="main-content">
        <!-- –°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è -->
        <div id="reading-lists" class="tab-content active">
            <div class="content-header">
                <h2 style="color: #f1f5f9; font-size: 24px; margin: 0;">–°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è</h2>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <div class="reading-list-mode-toggle" id="readingListModeToggle" style="display: flex;">
                        <button id="modeSingleBtn" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; border-radius: 8px 0 0 8px;" onclick="setReadingListsMode('single')">1</button>
                        <button id="modeDoubleBtn" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; border-radius: 0 8px 8px 0;" onclick="setReadingListsMode('double')">2</button>
                    </div>
                    <div class="reading-list-view-toggle" id="globalReadingListToggle" style="display: none;">
                        <button class="active" onclick="toggleAllReadingListViews('list')">üìã</button>
                        <button onclick="toggleAllReadingListViews('grid')">üî≤</button>
                    </div>
                </div>
            </div>
            
            <div class="list-input-group">
                <input type="text" id="newListName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è">
                <button class="btn btn-primary" onclick="addReadingList()">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
            <button class="reading-lists-toggle-btn mobile-top" id="readingListsToggleBtn" style="display:none;">
                <span id="readingListsToggleIcon">‚ò∞</span> <span id="readingListsToggleText">–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–∫–∏</span>
            </button>
            
            <div class="reading-lists-grid-page" id="readingListsGrid"></div>
            <div id="readingListsContainer"></div>
        </div>

        <!-- –ö–æ–ª–ª–µ–∫—Ü–∏—è -->
        <div id="collection" class="tab-content">
            <div class="content-header">
                <div class="controls">
                    <div class="view-toggle">
                        <button class="active" onclick="toggleView('collection', 'list')">üìã</button>
                        <button onclick="toggleView('collection', 'grid')">üî≤</button>
                    </div>
                    <input type="text" class="search-box" placeholder="–ü–æ–∏—Å–∫ –∫–æ–º–∏–∫—Å–æ–≤..." oninput="filterComics()">
                    <select class="sort-select" onchange="sortComics()">
                        <option value="dateAdded">–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</option>
                        <option value="title">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                        <option value="years">–ü–æ –≥–æ–¥–∞–º –≤—ã—Ö–æ–¥–∞</option>
                        <option value="progress">–ü–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É —á—Ç–µ–Ω–∏—è</option>
                    </select>
                </div>
            </div>
            
            <div class="stats" id="collectionStats"></div>
            
            <div id="collectionComics"></div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–∏–∫—Å–∞ -->
    <button class="add-comic-btn" onclick="showComicModal()" title="–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∏–∫—Å">+</button>

    <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <div class="scroll-buttons">
        <button class="scroll-btn" onclick="scrollToTop()" title="–ù–∞–≤–µ—Ä—Ö">‚Üë</button>
        <button class="scroll-btn" onclick="scrollToBottom()" title="–í–Ω–∏–∑">‚Üì</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ–º–∏–∫—Å–∞ -->
    <div class="modal" id="comicModal">
        <div class="modal-content">
            <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∏–∫—Å</h3>
            <form id="comicForm">
                <div class="form-group">
                    <label for="comicTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∏–∫—Å–∞ *</label>
                    <input type="text" id="comicTitle" required>
                </div>
                
                <div class="form-group">
                    <label for="comicCover">–°—Å—ã–ª–∫–∞ –Ω–∞ –æ–±–ª–æ–∂–∫—É</label>
                    <input type="url" id="comicCover">
                </div>
                
                <div class="form-group">
                    <label for="comicContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (—Å–µ—Ä–∏–∏ –∏ –Ω–æ–º–µ—Ä–∞ –≤—ã–ø—É—Å–∫–æ–≤) *</label>
                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 6px;">
                        <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px;" onclick="wrapSelection('comicContent', '**', '**')" title="–ñ–∏—Ä–Ω—ã–π (Ctrl+B)"><b>–ñ–∏—Ä–Ω—ã–π</b></button>
                        <button type="button" class="btn btn-secondary" style="padding: 6px 12px; font-size: 13px; opacity:0.7;" onclick="wrapSelection('comicContent', '~~', '~~')" title="–ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π (Ctrl+T)">–ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π</button>
                    </div>
                    <textarea id="comicContent" rows="3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Amazing Spider-Man #100-125, Spectacular Spider-Man #50-52" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="comicYears">–ü–µ—Ä–∏–æ–¥ –≤—ã—Ö–æ–¥–∞ (–≥–æ–¥—ã) *</label>
                    <input type="text" id="comicYears" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1985-1987" required>
                </div>
                
                <div class="form-group">
                    <label>–°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è</label>
                    <div class="reading-lists-grid" id="readingListsSelection"></div>
                </div>
                
                <div class="form-group progress-slider-group">
                    <label for="progressSlider">–ü—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è</label>
                    <input type="range" id="progressSlider" class="progress-slider" min="0" max="100" value="0" oninput="updateProgressInputs()">
                    <div class="progress-inputs">
                        <label>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ:</label>
                        <input type="number" id="readIssues" min="0" value="0" onchange="updateProgressSlider()">
                        <label>–∏–∑</label>
                        <input type="number" id="totalIssues" min="1" value="1" onchange="updateProgressSlider()">
                        <label>–≤—ã–ø—É—Å–∫–æ–≤</label>
                    </div>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hideComicModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ -->
    <div class="modal" id="listModal">
        <div class="modal-content">
            <h3 id="listModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫</h3>
            <form id="listForm">
                <div class="form-group">
                    <label for="listName">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ *</label>
                    <input type="text" id="listName" required>
                </div>
                
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="hideListModal()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>
            </form>
        </div>
    </div>



    <script>
        // –î–∞–Ω–Ω—ã–µ
        let comicsData = JSON.parse(localStorage.getItem('marvel-comics-data') || '[]');
        let readingLists = JSON.parse(localStorage.getItem('marvel-reading-lists') || JSON.stringify([
            '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Marvel',
            '–í–µ–Ω–æ–º',
            '–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫',
            '–õ—é–¥–∏-–ò–∫—Å',
            '–ö–∞—Ä–∞—Ç–µ–ª—å',
            '–õ—É–Ω–Ω—ã–π –†—ã—Ü–∞—Ä—å',
            '–ß—ë—Ä–Ω–∞—è –≤–¥–æ–≤–∞',
            '–°–æ—Ä–≤–∏–≥–æ–ª–æ–≤–∞',
            '–•–∞–ª–∫',
            '–¢–æ—Ä',
            '–ñ–µ–ª–µ–∑–Ω—ã–π –ß–µ–ª–æ–≤–µ–∫',
            '–ú—Å—Ç–∏—Ç–µ–ª–∏',
            '–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –ß–µ—Ç–≤—ë—Ä–∫–∞',
            '–î–æ–∫—Ç–æ—Ä –°—Ç—ç–Ω–¥–∂',
            '–ö–∞–ø–∏—Ç–∞–Ω –ê–º–µ—Ä–∏–∫–∞',
            '–ó–∏–º–Ω–∏–π —Å–æ–ª–¥–∞—Ç',
            '–î—ç–¥–ø—É–ª'
        ]));
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∫–æ–º–∏–∫—Å–æ–≤ –≤ —Å–ø–∏—Å–∫–∞—Ö —á—Ç–µ–Ω–∏—è
        let listOrders = JSON.parse(localStorage.getItem('marvel-list-orders') || '{}');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
        let listViewModes = JSON.parse(localStorage.getItem('marvel-list-view-modes') || '{}');
        
        let appSettings = JSON.parse(localStorage.getItem('marvel-app-settings') || '{}');
        let currentTab = 'reading-lists';
        let currentView = appSettings.view || 'list';
        let currentSort = appSettings.sort || 'dateAdded';
        let editingComic = null;
        let editingList = null;
        let expandedLists = new Set();
		
		// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–ª–∞–¥–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è (ID –∫–æ–º–∏–∫—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–µ–π—á–∞—Å —á–∏—Ç–∞–µ—Ç—Å—è)
		let currentlyReading = JSON.parse(localStorage.getItem('marvel-currently-reading') || '{}');

        let readingListsMode = localStorage.getItem('marvel-reading-lists-mode') || 'double';
        let openedLists = JSON.parse(localStorage.getItem('marvel-opened-lists') || 'null');
        if (!openedLists || !Array.isArray(openedLists)) {
            openedLists = readingLists.slice(0, 2);
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∂–∏–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞
        let listSortModes = JSON.parse(localStorage.getItem('marvel-list-sort-modes') || '{}');

        // --- FIREBASE AUTH ---
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        }
        function logout() {
            auth.signOut();
        }
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline-block';
                document.getElementById('userName').textContent = user.displayName || user.email;
                loadUserDataFromFirestore();
            } else {
                document.getElementById('loginBtn').style.display = 'inline-block';
                document.getElementById('logoutBtn').style.display = 'none';
                document.getElementById('userName').textContent = '';
                // –û–ß–ò–©–ê–ï–ú –í–°–ï –î–ê–ù–ù–´–ï
                comicsData = [];
                readingLists = [];
                listOrders = {};
                listViewModes = {};
                appSettings = {};
                currentlyReading = {};
                expandedLists = new Set();
                // –û—á–∏—â–∞–µ–º localStorage (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)
                localStorage.removeItem('marvel-comics-data');
                localStorage.removeItem('marvel-reading-lists');
                localStorage.removeItem('marvel-list-orders');
                localStorage.removeItem('marvel-list-view-modes');
                localStorage.removeItem('marvel-app-settings');
                localStorage.removeItem('marvel-currently-reading');
                localStorage.removeItem('marvel-list-sort-modes');
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                renderCollection();
                renderReadingLists();
            }
        });

        // --- FIRESTORE SAVE/LOAD ---
        function saveData() {
            const user = auth.currentUser;
            if (user) {
                db.collection('comics').doc(user.uid).set({
                    comicsData,
                    readingLists,
                    listOrders,
                    listViewModes,
                    appSettings,
                    currentlyReading
                });
            }
            // –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å localStorage –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
            localStorage.setItem('marvel-comics-data', JSON.stringify(comicsData));
            localStorage.setItem('marvel-reading-lists', JSON.stringify(readingLists));
            localStorage.setItem('marvel-list-orders', JSON.stringify(listOrders));
            localStorage.setItem('marvel-list-view-modes', JSON.stringify(listViewModes));
            appSettings.view = currentView;
            appSettings.sort = currentSort;
            localStorage.setItem('marvel-app-settings', JSON.stringify(appSettings));
            localStorage.setItem('marvel-currently-reading', JSON.stringify(currentlyReading));
            localStorage.setItem('marvel-list-sort-modes', JSON.stringify(listSortModes));
        }

        function loadUserDataFromFirestore() {
            const user = auth.currentUser;
            if (!user) return;
            db.collection('comics').doc(user.uid).get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    comicsData = data.comicsData || [];
                    readingLists = data.readingLists || [];
                    listOrders = data.listOrders || {};
                    listViewModes = data.listViewModes || {};
                    appSettings = data.appSettings || {};
                    currentlyReading = data.currentlyReading || {};
                    currentView = appSettings.view || 'list';
                    currentSort = appSettings.sort || 'dateAdded';
                    renderCollection();
                    renderReadingLists();
                } else {
                    // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ
                    comicsData = JSON.parse(localStorage.getItem('marvel-comics-data') || '[]');
                    readingLists = JSON.parse(localStorage.getItem('marvel-reading-lists') || JSON.stringify([
                        '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π Marvel',
                        '–í–µ–Ω–æ–º',
                        '–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫',
                        '–õ—é–¥–∏-–ò–∫—Å',
                        '–ö–∞—Ä–∞—Ç–µ–ª—å',
                        '–õ—É–Ω–Ω—ã–π –†—ã—Ü–∞—Ä—å',
                        '–ß—ë—Ä–Ω–∞—è –≤–¥–æ–≤–∞',
                        '–°–æ—Ä–≤–∏–≥–æ–ª–æ–≤–∞',
                        '–•–∞–ª–∫',
                        '–¢–æ—Ä',
                        '–ñ–µ–ª–µ–∑–Ω—ã–π –ß–µ–ª–æ–≤–µ–∫',
                        '–ú—Å—Ç–∏—Ç–µ–ª–∏',
                        '–§–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫–∞—è –ß–µ—Ç–≤—ë—Ä–∫–∞',
                        '–î–æ–∫—Ç–æ—Ä –°—Ç—ç–Ω–¥–∂',
                        '–ö–∞–ø–∏—Ç–∞–Ω –ê–º–µ—Ä–∏–∫–∞',
                        '–ó–∏–º–Ω–∏–π —Å–æ–ª–¥–∞—Ç',
                        '–î—ç–¥–ø—É–ª'
                    ]));
                    listOrders = JSON.parse(localStorage.getItem('marvel-list-orders') || '{}');
                    listViewModes = JSON.parse(localStorage.getItem('marvel-list-view-modes') || '{}');
                    appSettings = JSON.parse(localStorage.getItem('marvel-app-settings') || '{}');
                    currentlyReading = JSON.parse(localStorage.getItem('marvel-currently-reading') || '{}');
                    currentView = appSettings.view || 'list';
                    currentSort = appSettings.sort || 'dateAdded';
                    renderCollection();
                    renderReadingLists();
                }
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞ —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è
        function toggleReadingListView(listName, view) {
            listViewModes[listName] = view;
            saveData();
            renderReadingListContent();
        }

        // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞ –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
        function toggleAllReadingListViews(view) {
            expandedLists.forEach(listName => {
                listViewModes[listName] = view;
            });
            saveData();
            renderReadingListContent();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
            const toggleButtons = document.querySelectorAll('#globalReadingListToggle button');
            toggleButtons.forEach(btn => btn.classList.remove('active'));
            if (view === 'list') {
                toggleButtons[0].classList.add('active');
            } else {
                toggleButtons[1].classList.add('active');
            }
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function scrollToBottom() {
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –≤–∫–ª–∞–¥–æ–∫
        function updateTabIndicator() {
            const activeTab = document.querySelector('.tab-button.active');
            const indicator = document.querySelector('.tab-indicator');
            
            if (activeTab && indicator) {
                const rect = activeTab.getBoundingClientRect();
                const containerRect = activeTab.parentElement.getBoundingClientRect();
                
                indicator.style.width = rect.width + 'px';
                indicator.style.left = (rect.left - containerRect.left) + 'px';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tab) {
            if (currentTab === tab) return;
            
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            const tabs = ['reading-lists', 'collection'];
            document.querySelectorAll('.tab-button').forEach((btn, index) => {
                if (tabs[index] === tab) {
                    btn.classList.add('active');
                }
            });
            
            document.getElementById(tab).classList.add('active');
            
            currentTab = tab;
            updateTabIndicator();
            
            if (tab === 'collection') {
                renderCollection();
            } else if (tab === 'reading-lists') {
                renderReadingLists();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∞
        function toggleView(tab, view) {
            const viewButtons = document.querySelector(`#${tab} .view-toggle`).children;
            Array.from(viewButtons).forEach(btn => btn.classList.remove('active'));
            
            if (view === 'list') {
                viewButtons[0].classList.add('active');
            } else {
                viewButtons[1].classList.add('active');
            }
            
            currentView = view;
            saveData();
            renderCollection();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è
		function toggleReadingList(listName) {
			if (readingListsMode === 'double') {
				// –í double-—Ä–µ–∂–∏–º–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –ø–æ –∫–ª–∏–∫—É (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ 1/2)
				return;
			}
			if (expandedLists.has(listName)) {
				expandedLists.delete(listName);
			} else {
				expandedLists.clear();
				expandedLists.add(listName);
				setTimeout(() => {
					scrollToCurrentlyReading(listName);
				}, 100);
			}
			renderReadingLists();
		}

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–ø—É—Å–∫–æ–≤
        function parseIssuesCount(content) {
            if (!content) return 1;
            
            let totalIssues = 0;
            const ranges = content.match(/#\d+(-\d+)?/g) || [];
            
            ranges.forEach(range => {
                const numbers = range.replace('#', '').split('-');
                if (numbers.length === 2) {
                    const start = parseInt(numbers[0]);
                    const end = parseInt(numbers[1]);
                    totalIssues += Math.abs(end - start) + 1;
                } else {
                    totalIssues += 1;
                }
            });
            
            return Math.max(totalIssues, 1);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ª–∞–π–¥–µ—Ä–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgressSlider() {
            const readIssues = parseInt(document.getElementById('readIssues').value) || 0;
            const totalIssues = parseInt(document.getElementById('totalIssues').value) || 1;
            const percentage = Math.min((readIssues / totalIssues) * 100, 100);
            document.getElementById('progressSlider').value = percentage;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgressInputs() {
            const percentage = parseInt(document.getElementById('progressSlider').value);
            const totalIssues = parseInt(document.getElementById('totalIssues').value) || 1;
            const readIssues = Math.round((percentage / 100) * totalIssues);
            document.getElementById('readIssues').value = readIssues;
        }

        // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –≤ —Å–ø–∏—Å–∫–∞—Ö
        function updateComicProgress(comicId, newProgress) {
            const comic = comicsData.find(c => c.id === comicId);
            if (comic) {
                const newReadIssues = Math.round((newProgress / 100) * comic.totalIssues);
                comic.readIssues = newReadIssues;
                comic.isRead = newReadIssues >= comic.totalIssues;
                saveData();
                renderCollection();
                renderReadingListContent();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–º–∏–∫—Å–∞
        function showComicModal(comic = null) {
            editingComic = comic;
            const modal = document.getElementById('comicModal');
            const title = document.getElementById('modalTitle');
            const form = document.getElementById('comicForm');
            
            form.reset();
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
            const listsContainer = document.getElementById('readingListsSelection');
            listsContainer.innerHTML = readingLists.map(list => `
                <div class="reading-list-checkbox">
                    <input type="checkbox" id="list-${list}" value="${list}">
                    <label for="list-${list}">${list}</label>
                </div>
            `).join('');
            
            if (comic) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∏–∫—Å';
                document.getElementById('comicTitle').value = comic.title || '';
                document.getElementById('comicCover').value = comic.cover || '';
                document.getElementById('comicContent').value = comic.content || '';
                document.getElementById('comicYears').value = comic.years || '';
                document.getElementById('readIssues').value = comic.readIssues || 0;
                document.getElementById('totalIssues').value = comic.totalIssues || 1;
                
                // –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
                if (comic.readingLists && comic.readingLists.length > 0) {
                    comic.readingLists.forEach(list => {
                        const checkbox = document.getElementById(`list-${list}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
                
                updateProgressSlider();
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∏–∫—Å';
                document.getElementById('readIssues').value = 0;
                document.getElementById('totalIssues').value = 1;
                document.getElementById('progressSlider').value = 0;
            }
            
            modal.style.display = 'block';
        }

        // –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ–º–∏–∫—Å–∞
        function hideComicModal() {
            document.getElementById('comicModal').style.display = 'none';
            editingComic = null;
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è
        document.getElementById('comicContent').addEventListener('input', function() {
            if (!editingComic) {
                const totalIssues = parseIssuesCount(this.value);
                document.getElementById('totalIssues').value = totalIssues;
                updateProgressSlider();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∫–æ–º–∏–∫—Å–∞
        document.getElementById('comicForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const selectedLists = Array.from(document.querySelectorAll('#readingListsSelection input:checked')).map(cb => cb.value);
            
            const formData = {
                id: editingComic ? editingComic.id : Date.now(),
                title: document.getElementById('comicTitle').value.trim(),
                cover: document.getElementById('comicCover').value.trim(),
                content: document.getElementById('comicContent').value.trim(),
                years: document.getElementById('comicYears').value.trim(),
                readingLists: selectedLists,
                readIssues: parseInt(document.getElementById('readIssues').value) || 0,
                totalIssues: parseInt(document.getElementById('totalIssues').value) || 1,
                dateAdded: editingComic ? editingComic.dateAdded : new Date().toISOString(),
                isRead: false
            };

            formData.isRead = formData.readIssues >= formData.totalIssues;

            if (editingComic) {
                const index = comicsData.findIndex(c => c.id === editingComic.id);
                if (index !== -1) {
                    const oldLists = editingComic.readingLists || [];
                    const newLists = selectedLists;
                    
                    oldLists.forEach(listName => {
                        if (!newLists.includes(listName) && listOrders[listName]) {
                            listOrders[listName] = listOrders[listName].filter(id => id !== editingComic.id);
                        }
                    });
                    
                    newLists.forEach(listName => {
						if (!oldLists.includes(listName)) {
							if (!listOrders[listName]) {
								listOrders[listName] = [];
							}
							if (!listOrders[listName].includes(editingComic.id)) {
								// –î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
								const newYear = parseInt(formData.years.split('-')[0]) || 0;
								console.log('–î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å', formData.title, '–≤ –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫', listName, '–≥–æ–¥:', newYear);
								// –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∏–∫—Å—ã –≤ —Å–ø–∏—Å–∫–µ (–ù–ï –∏—Å–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â–∏–π, —Ç–∞–∫ –∫–∞–∫ –µ–≥–æ —Ç–∞–º –µ—â–µ –Ω–µ—Ç)
								const existingComics = comicsData.filter(comic => 
									comic.readingLists && comic.readingLists.includes(listName)
								);
								const tempOrdered = [];
								let inserted = false;
								// –ï—Å–ª–∏ —Ä–µ–∂–∏–º "–í –∫–æ–Ω–µ—Ü" ‚Äî –ø—Ä–æ—Å—Ç–æ –≤ –∫–æ–Ω–µ—Ü
								if (listSortModes[listName] === 'end') {
									listOrders[listName].push(editingComic.id);
									inserted = true;
								}
								listOrders[listName].forEach(id => {
									const comic = existingComics.find(c => c.id === id);
									if (comic) {
										const existingYear = parseInt(comic.years.split('-')[0]) || 0;
										if (!inserted && newYear < existingYear) {
											tempOrdered.push(editingComic.id);
											inserted = true;
											console.log('–í—Å—Ç–∞–≤–∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å –ø–µ—Ä–µ–¥', comic.title);
										}
										tempOrdered.push(id);
									}
								});
								if (!inserted && listSortModes[listName] !== 'end') {
									tempOrdered.push(editingComic.id);
									console.log('–î–æ–±–∞–≤–∏–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞');
								}
								if (listSortModes[listName] !== 'end') listOrders[listName] = tempOrdered;
							}
						}
					});
                    comicsData[index] = formData;
                }
            } else {
                comicsData.push(formData);
                
                selectedLists.forEach(listName => {
					if (!listOrders[listName]) {
						listOrders[listName] = [];
					}
					// –î–ª—è –Ω–æ–≤–æ–≥–æ –∫–æ–º–∏–∫—Å–∞ –Ω–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ –≥–æ–¥—É –∏–ª–∏ –≤ –∫–æ–Ω–µ—Ü
					const newYear = parseInt(formData.years.split('-')[0]) || 0;
					console.log('–î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∏–∫—Å', formData.title, '–≤ —Å–ø–∏—Å–æ–∫', listName, '–≥–æ–¥:', newYear);
					const existingComics = comicsData.filter(comic => 
						comic.readingLists && comic.readingLists.includes(listName) && comic.id !== formData.id
					);
					const tempOrdered = [];
					let inserted = false;
					// –ï—Å–ª–∏ —Ä–µ–∂–∏–º "–í –∫–æ–Ω–µ—Ü" ‚Äî –ø—Ä–æ—Å—Ç–æ –≤ –∫–æ–Ω–µ—Ü
					if (listSortModes[listName] === 'end') {
						listOrders[listName].push(formData.id);
						inserted = true;
					}
					listOrders[listName].forEach(id => {
						const comic = existingComics.find(c => c.id === id);
						if (comic) {
							const existingYear = parseInt(comic.years.split('-')[0]) || 0;
							if (!inserted && newYear < existingYear) {
								tempOrdered.push(formData.id);
								inserted = true;
								console.log('–í—Å—Ç–∞–≤–∏–ª–∏ –∫–æ–º–∏–∫—Å –ø–µ—Ä–µ–¥', comic.title);
							}
							tempOrdered.push(id);
						}
					});
					if (!inserted && listSortModes[listName] !== 'end') {
						tempOrdered.push(formData.id);
						console.log('–î–æ–±–∞–≤–∏–ª–∏ –∫–æ–º–∏–∫—Å –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞');
					}
					if (listSortModes[listName] !== 'end') listOrders[listName] = tempOrdered;
				});
            }

            saveData();
            renderCollection();
            renderReadingLists();
            hideComicModal();
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–º–∏–∫—Å–∞
        function deleteComic(comicId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∏–∫—Å?')) {
                comicsData = comicsData.filter(c => c.id !== comicId);
                
                Object.keys(listOrders).forEach(listName => {
                    listOrders[listName] = listOrders[listName].filter(id => id !== comicId);
                });
                
                saveData();
                renderCollection();
                renderReadingLists();
            }
        }
		
		// –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–∏–∫—Å–∞
		function copyComic(comicId) {
			const originalComic = comicsData.find(c => c.id === comicId);
			if (originalComic) {
				const copiedComic = {
					...originalComic,
					id: Date.now(),
					title: originalComic.title,
					dateAdded: new Date().toISOString(),
					readIssues: 0,
					isRead: false
				};
				
				comicsData.push(copiedComic);
				
				// –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–µ –∂–µ —Å–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è
				if (originalComic.readingLists && originalComic.readingLists.length > 0) {
					originalComic.readingLists.forEach(listName => {
						if (!listOrders[listName]) {
							listOrders[listName] = [];
						}
						
						// –î–ª—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–º–∏–∫—Å–∞ –Ω–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø–æ –≥–æ–¥—É
						const newYear = parseInt(copiedComic.years.split('-')[0]) || 0;
						console.log('–î–æ–±–∞–≤–ª—è–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å', copiedComic.title, '–≤ —Å–ø–∏—Å–æ–∫', listName, '–≥–æ–¥:', newYear);
						
						// –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–º–∏–∫—Å—ã –≤ —Å–ø–∏—Å–∫–µ
						const existingComics = comicsData.filter(comic => 
							comic.readingLists && comic.readingLists.includes(listName) && comic.id !== copiedComic.id
						);
						
						const tempOrdered = [];
						let inserted = false;
						
						listOrders[listName].forEach(id => {
							const comic = existingComics.find(c => c.id === id);
							if (comic) {
								const existingYear = parseInt(comic.years.split('-')[0]) || 0;
								
								if (!inserted && newYear < existingYear) {
									tempOrdered.push(copiedComic.id);
									inserted = true;
									console.log('–í—Å—Ç–∞–≤–∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å –ø–µ—Ä–µ–¥', comic.title);
								}
								tempOrdered.push(id);
							}
						});
						
						if (!inserted) {
							tempOrdered.push(copiedComic.id);
							console.log('–î–æ–±–∞–≤–∏–ª–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–∏–∫—Å –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞');
						}
						
						listOrders[listName] = tempOrdered;
					});
				}
				
				saveData();
				renderCollection();
				renderReadingLists();
				
				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
				alert('–ö–æ–º–∏–∫—Å —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
			}
		}
		
		// –£—Å—Ç–∞–Ω–æ–≤–∫–∞/—Å–Ω—è—Ç–∏–µ –∑–∞–∫–ª–∞–¥–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ —á—Ç–µ–Ω–∏—è
		function toggleCurrentlyReading(comicId, listName) {
			if (currentlyReading[listName] === comicId) {
				// –°–Ω–∏–º–∞–µ–º –∑–∞–∫–ª–∞–¥–∫—É
				delete currentlyReading[listName];
			} else {
				// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—É—é –∑–∞–∫–ª–∞–¥–∫—É
				currentlyReading[listName] = comicId;
			}
			
			saveData();
			renderReadingListContent();
		}

		// –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Ç–µ–∫—É—â–µ–º—É –∫–æ–º–∏–∫—Å—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–ø–∏—Å–∫–∞
		function scrollToCurrentlyReading(listName) {
			if (currentlyReading[listName]) {
				setTimeout(() => {
					const element = document.querySelector(`[data-comic-id="${currentlyReading[listName]}"]`);
					if (element) {
						element.scrollIntoView({ 
							behavior: 'smooth', 
							block: 'center' 
						});
						
						// –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
						element.style.boxShadow = '0 0 20px rgba(245, 158, 11, 0.6)';
						setTimeout(() => {
							element.style.boxShadow = '';
						}, 2000);
					}
				}, 300);
			}
		}

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ—Å—Ç–∏
        function toggleReadStatus(comicId) {
            const comic = comicsData.find(c => c.id === comicId);
            if (comic) {
                comic.isRead = !comic.isRead;
                if (comic.isRead) {
                    comic.readIssues = comic.totalIssues;
                } else {
                    comic.readIssues = 0;
                }
                saveData();
                renderCollection();
                renderReadingListContent();
            }
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–∏–∫—Å–æ–≤
        function sortComics() {
            const sortSelect = document.querySelector('#collection .sort-select');
            currentSort = sortSelect.value;
            saveData();
            renderCollection();
        }

        function filterComics() {
            renderCollection();
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –º–∞—Å—Å–∏–≤–∞ –∫–æ–º–∏–∫—Å–æ–≤
        function sortComicsArray(comics, sortType) {
            return comics.sort((a, b) => {
                switch (sortType) {
                    case 'title':
                        return a.title.localeCompare(b.title, 'ru');
                    case 'years':
                        const yearA = parseInt(a.years.split('-')[0]) || 0;
                        const yearB = parseInt(b.years.split('-')[0]) || 0;
                        return yearA - yearB;
                    case 'progress':
                        const progressA = a.totalIssues > 0 ? (a.readIssues / a.totalIssues) : 0;
                        const progressB = b.totalIssues > 0 ? (b.readIssues / b.totalIssues) : 0;
                        return progressB - progressA;
                    case 'dateAdded':
                    default:
                        return new Date(b.dateAdded) - new Date(a.dateAdded);
                }
            });
        }

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–∏–∫—Å–æ–≤ –¥–ª—è —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è
function getSortedComicsForList(listName) {
    const listComics = comicsData.filter(comic => 
        comic.readingLists && comic.readingLists.includes(listName)
    );
    
    // –ï—Å–ª–∏ —Ä–µ–∂–∏–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ "–í –∫–æ–Ω–µ—Ü" ‚Äî –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø–æ—Ä—è–¥–æ–∫ –∏–∑ listOrders
    if (listSortModes[listName] === 'end') {
        if (listOrders[listName] && listOrders[listName].length > 0) {
            const ordered = [];
            const orderedIds = new Set();
            listOrders[listName].forEach(id => {
                const comic = listComics.find(c => c.id === id);
                if (comic) {
                    ordered.push(comic);
                    orderedIds.add(id);
                }
            });
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–º–∏–∫—Å—ã –≤ –∫–æ–Ω–µ—Ü
            const newComics = listComics.filter(comic => !orderedIds.has(comic.id));
            if (newComics.length > 0) {
                newComics.forEach(newComic => {
                    ordered.push(newComic);
                });
                listOrders[listName] = ordered.map(comic => comic.id);
                saveData();
            }
            return ordered;
        } else {
            // –ï—Å–ª–∏ –ø–æ—Ä—è–¥–∫–∞ –Ω–µ—Ç, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
            listOrders[listName] = listComics.map(comic => comic.id);
            saveData();
            return listComics;
        }
    }
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–æ–¥—É (—Å—Ç–∞—Ä–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
    if (listOrders[listName] && listOrders[listName].length > 0) {
        const ordered = [];
        const orderedIds = new Set();
        
        // –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–∏–∫—Å—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ
        listOrders[listName].forEach(id => {
            const comic = listComics.find(c => c.id === id);
            if (comic) {
                ordered.push(comic);
                orderedIds.add(id);
            }
        });
        
        // –ù–∞—Ö–æ–¥–∏–º –Ω–æ–≤—ã–µ –∫–æ–º–∏–∫—Å—ã
        const newComics = listComics.filter(comic => !orderedIds.has(comic.id));
        
        if (newComics.length > 0) {
            console.log('–ù–∞–π–¥–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–æ–º–∏–∫—Å—ã –¥–ª—è —Å–ø–∏—Å–∫–∞', listName, ':', newComics.map(c => c.title));
            
            // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω–æ–≤–æ–≥–æ –∫–æ–º–∏–∫—Å–∞ –Ω–∞—Ö–æ–¥–∏–º –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
            newComics.forEach(newComic => {
                const newYear = parseInt(newComic.years.split('-')[0]) || 0;
                console.log('–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∏–∫—Å:', newComic.title, '–≥–æ–¥:', newYear);
                
                let insertIndex = -1;
                
                // –ò—â–µ–º –ø–µ—Ä–≤—ã–π –∫–æ–º–∏–∫—Å —Å –≥–æ–¥–æ–º –±–æ–ª—å—à–µ –Ω–æ–≤–æ–≥–æ
                for (let i = 0; i < ordered.length; i++) {
                    const existingYear = parseInt(ordered[i].years.split('-')[0]) || 0;
                    console.log('–°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å:', ordered[i].title, '–≥–æ–¥:', existingYear);
                    if (newYear < existingYear) {
                        insertIndex = i;
                        console.log('–ù–∞–π–¥–µ–Ω–∞ –ø–æ–∑–∏—Ü–∏—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:', i);
                        break;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –º–µ—Å—Ç–æ, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü
                if (insertIndex === -1) {
                    console.log('–î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞');
                    ordered.push(newComic);
                } else {
                    console.log('–í—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –ø–æ–∑–∏—Ü–∏—é:', insertIndex);
                    ordered.splice(insertIndex, 0, newComic);
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Ä—è–¥–æ–∫ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
            listOrders[listName] = ordered.map(comic => comic.id);
            console.log('–ù–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è', listName, ':', ordered.map(c => c.title));
            saveData();
        }
        
        return ordered;
    } else {
        // –ï—Å–ª–∏ –ø–æ—Ä—è–¥–∫–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ –≥–æ–¥–∞–º
        const sorted = listComics.sort((a, b) => {
            const yearA = parseInt(a.years.split('-')[0]) || 0;
            const yearB = parseInt(b.years.split('-')[0]) || 0;
            return yearA - yearB;
        });
        
        listOrders[listName] = sorted.map(comic => comic.id);
        saveData();
        
        return sorted;
    }
}

		// Drag & Drop —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
		let draggedElement = null;
		let draggedComicId = null;
		let draggedFromList = null;

		// Drag & Drop –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
		let draggedListElement = null;
		let draggedListName = null;

        function enableDragAndDrop() {
            const readingListItems = document.querySelectorAll('.reading-list-item[data-comic-id]');
            
            readingListItems.forEach(item => {
                item.draggable = true;
                
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    draggedComicId = parseInt(this.dataset.comicId);
                    draggedFromList = this.dataset.list;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedElement = null;
                    draggedComicId = null;
                    draggedFromList = null;
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (draggedElement && draggedElement !== this) {
                        this.classList.add('drag-over');
                    }
                });
                
                item.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (draggedElement && draggedElement !== this && draggedFromList === this.dataset.list) {
                        const container = this.parentNode;
                        const afterElement = getDragAfterElement(container, e.clientY);
                        
                        if (afterElement == null) {
                            container.appendChild(draggedElement);
                        } else {
                            container.insertBefore(draggedElement, afterElement);
                        }
                        
                        updateReadingListOrder(draggedFromList);
                    }
                });
            });
        }

        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.reading-list-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
		
		function updateReadingListOrder(listName) {
			const container = document.querySelector(`[data-list="${listName}"]`).parentNode;
			const items = container.querySelectorAll('.reading-list-item[data-comic-id]');
			
			listOrders[listName] = Array.from(items).map(item => parseInt(item.dataset.comicId));
			saveData();
			// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫
			renderReadingListContent();
		}

        function enableGridDragAndDrop() {
            const gridItems = document.querySelectorAll('.reading-list-grid-item[data-comic-id]');
            
            gridItems.forEach(item => {
                item.draggable = true;
                
                item.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    draggedComicId = parseInt(this.dataset.comicId);
                    draggedFromList = this.dataset.list;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                });
                
                item.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    draggedElement = null;
                    draggedComicId = null;
                    draggedFromList = null;
                });
                
                item.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                
                item.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (draggedElement && draggedElement !== this) {
                        this.classList.add('drag-over');
                    }
                });
                
                item.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                item.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (draggedElement && draggedElement !== this && draggedFromList === this.dataset.list) {
                        const container = this.parentNode;
                        const afterElement = getDragAfterElementGrid(container, e.clientX, e.clientY);
                        
                        if (afterElement == null) {
                            container.appendChild(draggedElement);
                        } else {
                            container.insertBefore(draggedElement, afterElement);
                        }
                        
                        updateReadingListOrderFromGrid(draggedFromList);
                    }
                });
            });
        }

        function getDragAfterElementGrid(container, x, y) {
            const draggableElements = [...container.querySelectorAll('.reading-list-grid-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const centerX = box.left + box.width / 2;
                const centerY = box.top + box.height / 2;
                
                const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
                
                if (distance < closest.distance) {
                    return { distance: distance, element: child };
                } else {
                    return closest;
                }
            }, { distance: Number.POSITIVE_INFINITY }).element;
        }

        function updateReadingListOrderFromGrid(listName) {
            const container = document.querySelector(`[data-list="${listName}"]`).parentNode;
            const items = container.querySelectorAll('.reading-list-grid-item[data-comic-id]');
            
            listOrders[listName] = Array.from(items).map(item => parseInt(item.dataset.comicId));
            saveData();
            // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ–º —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –Ω–æ–º–µ—Ä–∞
            renderReadingListContent();
        }
		
		// Drag & Drop –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
		function enableReadingListDragAndDrop() {
			const listCards = document.querySelectorAll('.reading-list-card');
			
			listCards.forEach(card => {
				card.draggable = true;
				
				card.addEventListener('dragstart', function(e) {
					draggedListElement = this;
					draggedListName = this.querySelector('.reading-list-card-title').textContent;
					this.classList.add('dragging');
					e.dataTransfer.effectAllowed = 'move';
				});
				
				card.addEventListener('dragend', function(e) {
					this.classList.remove('dragging');
					draggedListElement = null;
					draggedListName = null;
				});
				
				card.addEventListener('dragover', function(e) {
					e.preventDefault();
					e.dataTransfer.dropEffect = 'move';
				});
				
				card.addEventListener('dragenter', function(e) {
					e.preventDefault();
					if (draggedListElement && draggedListElement !== this) {
						this.classList.add('drag-over');
					}
				});
				
				card.addEventListener('dragleave', function(e) {
					this.classList.remove('drag-over');
				});
				
				card.addEventListener('drop', function(e) {
					e.preventDefault();
					this.classList.remove('drag-over');
					
					if (draggedListElement && draggedListElement !== this) {
						const container = this.parentNode;
						const afterElement = getListDragAfterElement(container, e.clientX, e.clientY);
						
						if (afterElement == null) {
							container.appendChild(draggedListElement);
						} else {
							container.insertBefore(draggedListElement, afterElement);
						}
						
						updateReadingListsOrder();
					}
				});
			});
		}

		function getListDragAfterElement(container, x, y) {
			const draggableElements = [...container.querySelectorAll('.reading-list-card:not(.dragging)')];
			
			return draggableElements.reduce((closest, child) => {
				const box = child.getBoundingClientRect();
				const centerX = box.left + box.width / 2;
				const centerY = box.top + box.height / 2;
				
				const distance = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
				
				if (distance < closest.distance) {
					return { distance: distance, element: child };
				} else {
					return closest;
				}
			}, { distance: Number.POSITIVE_INFINITY }).element;
		}

		function updateReadingListsOrder() {
			const container = document.getElementById('readingListsGrid');
			const cards = container.querySelectorAll('.reading-list-card');
			
			const newOrder = Array.from(cards).map(card => 
				card.querySelector('.reading-list-card-title').textContent
			);
			
			readingLists.splice(0, readingLists.length, ...newOrder);
			
			saveData();
			renderReadingListGrid();
		}

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
        function renderCollection() {
            const container = document.getElementById('collectionComics');
            const searchTerm = document.querySelector('#collection .search-box').value.toLowerCase();
            
            let comics = comicsData.filter(comic => 
                comic.title.toLowerCase().includes(searchTerm) || 
                comic.content.toLowerCase().includes(searchTerm)
            );

            comics = sortComicsArray(comics, currentSort);

            renderCollectionStats();

            if (comics.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>üìö –ö–æ–º–∏–∫—Å–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–î–æ–±–∞–≤—å—Ç–µ –∫–æ–º–∏–∫—Å—ã –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã</p>
                    </div>
                `;
                return;
            }

            if (currentView === 'grid') {
                container.innerHTML = `<div class="comics-grid">${comics.map(comic => createComicCard(comic)).join('')}</div>`;
            } else {
                container.innerHTML = `<div class="comics-list">${comics.map(comic => createComicListItem(comic)).join('')}</div>`;
            }
            
            addProgressBarInteractivity();
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º
        function addProgressBarInteractivity() {
            const progressBars = document.querySelectorAll('.progress-bar');
            
            progressBars.forEach(bar => {
                const item = bar.closest('[data-comic-id]');
                if (!item) return;
                
                const comicId = parseInt(item.dataset.comicId);
                
                bar.addEventListener('click', function(e) {
                    const rect = this.getBoundingClientRect();
                    const clickX = e.clientX - rect.left;
                    const width = rect.width;
                    const percentage = Math.max(0, Math.min(100, (clickX / width) * 100));
                    
                    updateComicProgress(comicId, percentage);
                });
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function renderCollectionStats() {
            const statsContainer = document.getElementById('collectionStats');
            const totalComics = comicsData.length;
            const readComics = comicsData.filter(c => c.isRead).length;
            const totalIssues = comicsData.reduce((sum, comic) => sum + comic.totalIssues, 0);
            const readIssues = comicsData.reduce((sum, comic) => sum + comic.readIssues, 0);

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalComics}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∫–æ–º–∏–∫—Å–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${readComics}</div>
                    <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalIssues}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –≤—ã–ø—É—Å–∫–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${readIssues}</div>
                    <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ –≤—ã–ø—É—Å–∫–æ–≤</div>
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–∏–∫—Å–∞
        function createComicCard(comic) {
            const progress = comic.totalIssues > 0 ? (comic.readIssues / comic.totalIssues) * 100 : 0;
            const imageHtml = comic.cover ? 
                `<img src="${comic.cover}" alt="${comic.title}" class="comic-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="comic-image" style="display:none;">üìñ</div>` :
                `<div class="comic-image">üìñ</div>`;

            return `
                <div class="comic-card ${comic.isRead ? 'read' : ''}" data-comic-id="${comic.id}">
                    ${imageHtml}
                    <div class="comic-info">
                        <div class="comic-title">${comic.title}</div>
                        <div class="comic-content">${parseComicContent(comic.content)}</div>
                        <div class="comic-years">${comic.years}</div>
                        <div class="progress-indicator">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${comic.readIssues}/${comic.totalIssues} –≤—ã–ø—É—Å–∫–æ–≤</div>
                        </div>
                    </div>
                    <div class="comic-actions">
                        <button class="action-btn edit-btn" onclick="showComicModal(${JSON.stringify(comic).replace(/"/g, '&quot;')})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
						<button class="action-btn copy-btn" onclick="copyComic(${comic.id})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        <button class="action-btn read-btn" onclick="toggleReadStatus(${comic.id})" title="${comic.isRead ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π'}">${comic.isRead ? 'üìñ' : '‚úÖ'}</button>
                        <button class="action-btn delete-btn" onclick="deleteComic(${comic.id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∏–∫—Å–∞
        function createComicListItem(comic) {
            const progress = comic.totalIssues > 0 ? (comic.readIssues / comic.totalIssues) * 100 : 0;
            const imageHtml = comic.cover ? 
                `<img src="${comic.cover}" alt="${comic.title}" class="comic-list-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                 <div class="comic-list-image" style="display:none;">üìñ</div>` :
                `<div class="comic-list-image">üìñ</div>`;

            return `
                <div class="comic-list-item ${comic.isRead ? 'read' : ''}" data-comic-id="${comic.id}">
                    ${imageHtml}
                    <div class="comic-list-info">
                        <div class="comic-title">${comic.title}</div>
                        <div class="comic-content">${parseComicContent(comic.content)}</div>
                        <div class="comic-years">${comic.years}</div>
                        <div class="progress-indicator">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${comic.readIssues}/${comic.totalIssues} –≤—ã–ø—É—Å–∫–æ–≤ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                        </div>
                    </div>
                    <div class="comic-actions">
                        <button class="action-btn edit-btn" onclick="showComicModal(${JSON.stringify(comic).replace(/"/g, '&quot;')})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
						<button class="action-btn copy-btn" onclick="copyComic(${comic.id})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        <button class="action-btn read-btn" onclick="toggleReadStatus(${comic.id})" title="${comic.isRead ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π'}">${comic.isRead ? 'üìñ' : '‚úÖ'}</button>
                        <button class="action-btn delete-btn" onclick="deleteComic(${comic.id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                </div>
            `;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
        function renderReadingLists() {
            renderReadingListGrid();
            renderReadingListContent();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∂–∏–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            document.getElementById('modeSingleBtn').classList.toggle('active', readingListsMode === 'single');
            document.getElementById('modeDoubleBtn').classList.toggle('active', readingListsMode === 'double');
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞
            const globalToggle = document.getElementById('globalReadingListToggle');
            if ((readingListsMode === 'single' && expandedLists.size > 0) || readingListsMode === 'double') {
                globalToggle.style.display = 'flex';
            } else {
                globalToggle.style.display = 'none';
            }
        }

		// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–µ—Ç–∫–∏ —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
		function renderReadingListGrid() {
			const container = document.getElementById('readingListsGrid');
			
			if (readingLists.length === 0) {
				container.innerHTML = `
					<div class="empty-state">
						<h3>üìñ –°–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è –Ω–µ—Ç</h3>
						<p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ —á—Ç–µ–Ω–∏—è –≤—ã—à–µ</p>
					</div>
				`;
				return;
			}

			container.innerHTML = readingLists.map(listName => {
				const listComics = comicsData.filter(comic => 
					comic.readingLists && comic.readingLists.includes(listName)
				);
				const readCount = listComics.filter(c => c.isRead).length;
				let isActive = false;
				if (readingListsMode === 'double') {
					isActive = openedLists.includes(listName);
				} else {
					isActive = expandedLists.has(listName);
				}
				return `
					<div class="reading-list-card ${isActive ? 'active' : ''}" onmouseenter="this.classList.add('hovered')" onmouseleave="this.classList.remove('hovered')" onclick="toggleReadingList('${listName}')">
						<div class="reading-list-card-title">${listName}</div>
						<div class="reading-list-card-meta">${readCount}/${listComics.length} –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
						<div class="reading-list-card-actions" onclick="event.stopPropagation()">
							<button class="action-btn edit-btn" onclick="showListModal('${listName}')" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
							<button class="action-btn delete-btn" onclick="deleteReadingList('${listName}')" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
							${readingListsMode === 'double' ? `
								<button class="action-btn" style="background: #334155; color: #f59e0b; font-weight: bold; border: 2px solid #64748b;" onclick="setOpenedList('${listName}', 0)" title="–û—Ç–∫—Ä—ã—Ç—å –∫–∞–∫ –ø–µ—Ä–≤—ã–π">1</button>
								<button class="action-btn" style="background: #334155; color: #f59e0b; font-weight: bold; border: 2px solid #64748b;" onclick="setOpenedList('${listName}', 1)" title="–û—Ç–∫—Ä—ã—Ç—å –∫–∞–∫ –≤—Ç–æ—Ä–æ–π">2</button>
							` : ''}
						</div>
					</div>
				`;
			}).join('');
			
			// –í–∫–ª—é—á–∞–µ–º drag & drop –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
			setTimeout(() => {
				enableReadingListDragAndDrop();
			}, 100);
		}

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å–ø–∏—Å–∫–æ–≤ —á—Ç–µ–Ω–∏—è
        function renderReadingListContent() {
            const container = document.getElementById('readingListsContainer');
            
            // --- –°–æ—Ö—Ä–∞–Ω—è–µ–º scrollTop –¥–ª—è –¥–≤—É—Ö —Å–ø–∏—Å–∫–æ–≤ (–ø–æ –∏–º–µ–Ω–∏ —Å–ø–∏—Å–∫–∞) ---
            let scrollPositions = {};
            if (readingListsMode === 'double') {
                const cols = document.querySelectorAll('.reading-list-double-col');
                [0, 1].forEach(i => {
                    if (cols[i] && openedLists[i]) {
                        scrollPositions[openedLists[i]] = cols[i].scrollTop;
                    }
                });
            }
            if (readingListsMode === 'double') {
                // –î–≤–∞ —Å–ø–∏—Å–∫–∞ —Ä—è–¥–æ–º
                if (!openedLists || openedLists.length < 2) {
                    openedLists = readingLists.slice(0, 2);
                }
                container.innerHTML = `
                    <div style="display: flex; gap: 20px;">
                        <div class="reading-list-double-col" data-list-name="${openedLists[0] || ''}" style="flex:1; min-width:0; max-width:50%; height:91vh; overflow-y:auto; background:rgba(30,41,59,0.15); border-radius: 16px; border: 1px solid #475569;">
                             ${renderSingleReadingListContent(openedLists[0], 0)}
                         </div>
                        <div class="reading-list-double-col" data-list-name="${openedLists[1] || ''}" style="flex:1; min-width:0; max-width:50%; height:91vh; overflow-y:auto; background:rgba(30,41,59,0.15); border-radius: 16px; border: 1px solid #475569;">
                             ${renderSingleReadingListContent(openedLists[1], 1)}
                         </div>
                    </div>
                `;
                // --- –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º scrollTop –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ø–∏—Å–∫–∞ ---
                setTimeout(() => {
                    const cols = document.querySelectorAll('.reading-list-double-col');
                    [0, 1].forEach(i => {
                        if (cols[i] && openedLists[i] && scrollPositions[openedLists[i]] !== undefined) {
                            cols[i].scrollTop = scrollPositions[openedLists[i]];
                        }
                    });
                }, 0);
            } else {
                const expandedListsArray = Array.from(expandedLists);
                if (expandedListsArray.length === 0) {
                    container.innerHTML = '';
                    return;
                }
                container.innerHTML = expandedListsArray.map(listName => renderSingleReadingListContent(listName, 0)).join('');
            }
            setTimeout(() => {
                enableDragAndDrop();
                enableGridDragAndDrop();
                addProgressBarInteractivity();
            }, 100);
        }

        function renderSingleReadingListContent(listName, colIdx) {
            if (!listName) return '';
            const listComics = getSortedComicsForList(listName);
            const viewMode = listViewModes[listName] || 'list';
            const sortMode = listSortModes[listName] || 'years';
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –≤ double-—Ä–µ–∂–∏–º–µ
            let highlight = '';
            // –í —Ä–µ–∂–∏–º–µ double –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º border/box-shadow
            return `
                <div class="reading-list-content active" style="${highlight}">
                    <div class="reading-list-view-controls">
                        <h3 style="color: #f1f5f9; margin: 0; flex: 1;">${listName}</h3>
                        <button class="btn btn-secondary" onclick="exportReadingListToTxt('${listName}')" title="–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ TXT">üìÑ</button>
                        <div class="reading-list-sort-toggle">
                            <button class="${sortMode === 'years' ? 'active' : ''}" onclick="setListSortMode('${listName}', 'years')">–ü–æ –≥–æ–¥–∞–º</button>
                            <button class="${sortMode === 'end' ? 'active' : ''}" onclick="setListSortMode('${listName}', 'end')">–í –∫–æ–Ω–µ—Ü</button>
                        </div>
                        <div class="reading-list-view-toggle">
                            <button class="${viewMode === 'list' ? 'active' : ''}" onclick="toggleReadingListView('${listName}', 'list')">üìã</button>
                            <button class="${viewMode === 'grid' ? 'active' : ''}" onclick="toggleReadingListView('${listName}', 'grid')">üî≤</button>
                        </div>
                    </div>
                    ${listComics.length === 0 ? 
                        '<div style="text-align: center; color: #94a3b8; padding: 40px;">–ö–æ–º–∏–∫—Å–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç</div>' :
                        (viewMode === 'grid' ? 
                            `<div class="reading-list-grid-view">${listComics.map((comic, index) => createReadingListGridItem(comic, listName, index)).join('')}</div>` :
                            listComics.map(comic => createReadingListItem(comic, listName)).join('')
                        )
                    }
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è
        function createReadingListItem(comic, listName) {
            return `
                <div class="reading-list-item ${comic.isRead ? 'read' : ''}" data-comic-id="${comic.id}" data-list="${listName}">
                    <div class="reading-list-comic-info">

                        ${comic.cover ? 
                            `<img src="${comic.cover}" alt="${comic.title}" class="reading-list-image">` :
                            '<div class="reading-list-image">üìñ</div>'
                        }
                        <div class="reading-list-text-info">
                            <div class="reading-list-main-info">
                                <div class="reading-list-title-text">${comic.title}</div>
                                <div class="reading-list-years">${comic.years}</div>
                                <div class="reading-list-content-text">${parseComicContent(comic.content)}</div>
                            </div>
                            <div class="reading-list-progress">
                                <div class="reading-list-progress-blocks">
                                    ${createProgressBlocks(comic)}
                                </div>
                            </div>
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    <div class="comic-actions">
						 <button class="action-btn bookmark-action-btn ${currentlyReading[listName] === comic.id ? 'active' : ''}" 
							onclick="toggleCurrentlyReading(${comic.id}, '${listName}')" 
							title="${currentlyReading[listName] === comic.id ? '–°–Ω—è—Ç—å –∑–∞–∫–ª–∞–¥–∫—É' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ —á–∏—Ç–∞–µ–º—ã–π'}">‚≠ê</button>
                          <button class="action-btn edit-btn" onclick="showComicModal(${JSON.stringify(comic).replace(/"/g, '&quot;')})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
						 <button class="action-btn copy-btn" onclick="copyComic(${comic.id})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
						 <button class="action-btn read-btn" onclick="toggleReadStatus(${comic.id})" title="${comic.isRead ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π'}">${comic.isRead ? 'üìñ' : '‚úÖ'}</button>
						 <button class="action-btn delete-btn" onclick="deleteComic(${comic.id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–µ—Ç–æ—á–Ω–æ–≥–æ –≤–∏–¥–∞ –¥–ª—è —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è
        function createReadingListGridItem(comic, listName, index) {
            const progress = comic.totalIssues > 0 ? (comic.readIssues / comic.totalIssues) * 100 : 0;
            
            return `
                <div class="reading-list-grid-item ${comic.isRead ? 'read' : ''}" data-comic-id="${comic.id}" data-list="${listName}">
                    <div class="reading-list-order-arrow">${index + 1}</div>

                    ${comic.cover ? 
                        `<img src="${comic.cover}" alt="${comic.title}" class="reading-list-grid-image">` :
                        '<div class="reading-list-grid-image">üìñ</div>'
                    }
                    <div class="reading-list-grid-info">
                        <div class="reading-list-grid-title">${comic.title}</div>
                        <div class="reading-list-grid-meta">
                            <div class="reading-list-grid-years">${comic.years}</div>
                        </div>
                        <div class="reading-list-grid-content">${parseComicContent(comic.content)}</div>
                        <div class="reading-list-grid-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${comic.readIssues}/${comic.totalIssues} –≤—ã–ø—É—Å–∫–æ–≤</div>
                        </div>
                    </div>
                    <div class="comic-actions">
							<button class="action-btn bookmark-action-btn ${currentlyReading[listName] === comic.id ? 'active' : ''}" 
							onclick="toggleCurrentlyReading(${comic.id}, '${listName}')" 
							title="${currentlyReading[listName] === comic.id ? '–°–Ω—è—Ç—å –∑–∞–∫–ª–∞–¥–∫—É' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ —á–∏—Ç–∞–µ–º—ã–π'}">‚≠ê</button>
                          <button class="action-btn edit-btn" onclick="showComicModal(${JSON.stringify(comic).replace(/"/g, '&quot;')})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
						  <button class="action-btn copy-btn" onclick="copyComic(${comic.id})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
						  <button class="action-btn read-btn" onclick="toggleReadStatus(${comic.id})" title="${comic.isRead ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π'}">${comic.isRead ? 'üìñ' : '‚úÖ'}</button>
						  <button class="action-btn delete-btn" onclick="deleteComic(${comic.id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                </div>
            `;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±–ª–æ–∫–æ–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function createProgressBlocks(comic) {
            const blocks = [];
            const totalIssues = Math.min(comic.totalIssues, 100);
            const isMobile = window.innerWidth <= 768;
            const expanded = comic._mobileProgressExpanded;
            const blockWidth = totalIssues <= 10 ? '40px' : 
                              totalIssues <= 20 ? '35px' : 
                              totalIssues <= 50 ? '30px' : '25px';
            if (isMobile && !expanded) {
                // –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è
                blocks.push(`
                    <button class="btn btn-secondary mobile-progress-toggle" style="margin:8px 0; font-size:15px; padding:10px 0; width:100%; display:block;" onclick="toggleMobileProgressBlocks(${comic.id})">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä–∞</button>
                `);
            }
            if (!isMobile || expanded) {
                for (let i = 1; i <= totalIssues; i++) {
                    let blockClass = 'progress-block';
                    if (i <= comic.readIssues) {
                        blockClass += ' read';
                    }
                    blocks.push(`
                        <div class="${blockClass}" 
                             data-comic-id="${comic.id}" 
                             data-issue="${i}"
                             onclick="updateComicProgressFromBlock(${comic.id}, ${i})"
                             title="–í—ã–ø—É—Å–∫ ${i}"
                             style="width: ${blockWidth};">
                            ${i}
                        </div>
                    `);
                }
                if (comic.totalIssues > 100) {
                    blocks.push(`
                        <div class="progress-block" style="background: rgba(100, 116, 139, 0.5); cursor: default; width: ${blockWidth};" title="–í—Å–µ–≥–æ –≤—ã–ø—É—Å–∫–æ–≤: ${comic.totalIssues}">
                            +${comic.totalIssues - 100}
                        </div>
                    `);
                }
                if (isMobile) {
                    blocks.push(`
                        <button class="btn btn-secondary mobile-progress-toggle" style="margin:8px 0; font-size:15px; padding:10px 0; width:100%; display:block;" onclick="toggleMobileProgressBlocks(${comic.id})">–°–∫—Ä—ã—Ç—å –Ω–æ–º–µ—Ä–∞</button>
                    `);
                }
            }
            return blocks.join('');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–∑ –±–ª–æ–∫–∞
        function updateComicProgressFromBlock(comicId, issueNumber) {
            const comic = comicsData.find(c => c.id === comicId);
            if (comic) {
                // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –ø–µ—Ä–≤—ã–π –≤—ã–ø—É—Å–∫ –∏ –æ–Ω —É–∂–µ –ø—Ä–æ—á–∏—Ç–∞–Ω, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ 0
                if (issueNumber === 1 && comic.readIssues >= 1) {
                    comic.readIssues = 0;
                } else {
                    comic.readIssues = issueNumber;
                }
                comic.isRead = comic.readIssues >= comic.totalIssues;
                saveData();
                renderCollection();
                renderReadingListContent();
            }
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞–º–∏ —á—Ç–µ–Ω–∏—è
        function addReadingList() {
            const input = document.getElementById('newListName');
            const name = input.value.trim();
            
            if (name && !readingLists.includes(name)) {
                readingLists.push(name);
                saveData();
                input.value = '';
                renderReadingListGrid();
            }
        }

        function deleteReadingList(listName) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Å–ø–∏—Å–æ–∫ "${listName}"? –ö–æ–º–∏–∫—Å—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.`)) {
                const listIndex = readingLists.indexOf(listName);
                if (listIndex !== -1) {
                    readingLists.splice(listIndex, 1);
                }
                delete listOrders[listName];
                delete listViewModes[listName];
                expandedLists.delete(listName);
                
                comicsData.forEach(comic => {
                    if (comic.readingLists) {
                        comic.readingLists = comic.readingLists.filter(list => list !== listName);
                    }
                });
                
                saveData();
                renderReadingListGrid();
                renderReadingListContent();
            }
        }

        function showListModal(listName = null) {
            editingList = listName;
            const modal = document.getElementById('listModal');
            const title = document.getElementById('listModalTitle');
            
            if (listName) {
                title.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫';
                document.getElementById('listName').value = listName;
            } else {
                title.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫';
                document.getElementById('listName').value = '';
            }
            
            modal.style.display = 'block';
        }

        function hideListModal() {
            document.getElementById('listModal').style.display = 'none';
            editingList = null;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Å–ø–∏—Å–∫–∞
        document.getElementById('listForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newName = document.getElementById('listName').value.trim();
            
            if (newName && newName !== editingList && !readingLists.includes(newName)) {
                if (editingList) {
                    const index = readingLists.indexOf(editingList);
                    if (index !== -1) {
                        readingLists[index] = newName;
                    }
                    
                    if (listOrders[editingList]) {
                        listOrders[newName] = listOrders[editingList];
                        delete listOrders[editingList];
                    }

                    if (listViewModes[editingList]) {
                        listViewModes[newName] = listViewModes[editingList];
                        delete listViewModes[editingList];
                    }
                    
                    if (expandedLists.has(editingList)) {
                        expandedLists.delete(editingList);
                        expandedLists.add(newName);
                    }
                    
                    comicsData.forEach(comic => {
                        if (comic.readingLists && comic.readingLists.includes(editingList)) {
                            const listIndex = comic.readingLists.indexOf(editingList);
                            comic.readingLists[listIndex] = newName;
                        }
                    });
                } else {
                    readingLists.push(newName);
                }
                
                saveData();
                renderReadingListGrid();
                renderReadingListContent();
                hideListModal();
            }
        });

        // –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const exportData = {
                comicsData: comicsData,
                readingLists: readingLists,
                listOrders: listOrders,
                listViewModes: listViewModes,
				currentlyReading: currentlyReading,
                settings: appSettings
            };
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `marvel-comics-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
		
		// –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ —á—Ç–µ–Ω–∏—è –≤ TXT —Ñ–∞–π–ª
		function exportReadingListToTxt(listName) {
			const listComics = getSortedComicsForList(listName);
			
			if (listComics.length === 0) {
				alert('–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç - –Ω–µ—á–µ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å');
				return;
			}
			
			let txtContent = '';
			listComics.forEach((comic, index) => {
				txtContent += `${index + 1}. ${comic.title} (${comic.years}) - ${comic.content}\n`;
			});
			
			const dataBlob = new Blob([txtContent], { type: 'text/plain; charset=utf-8' });
			const url = URL.createObjectURL(dataBlob);
			const link = document.createElement('a');
			link.href = url;
			link.download = `${listName.replace(/[^a-zA-Z–∞-—è–ê-–Ø0-9]/g, '_')}.txt`;
			link.click();
			URL.revokeObjectURL(url);
		}

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (confirm('–ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏? (–¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã)')) {
                            comicsData = importedData.comicsData || [];
                            readingLists = importedData.readingLists || [];
                            listOrders = importedData.listOrders || {};
                            listViewModes = importedData.listViewModes || {};
                            appSettings = importedData.settings || {};
                            currentlyReading = importedData.currentlyReading || {};
                            currentView = appSettings.view || 'list';
                            currentSort = appSettings.sort || 'dateAdded';
                            expandedLists.clear();
                            
                            saveData();
                            renderCollection();
                            renderReadingLists();
                            alert('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                        }
                    } catch (error) {
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö.');
                    }
                };
                reader.readAsText(file);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        document.addEventListener('click', (e) => {
            const comicModal = document.getElementById('comicModal');
            const listModal = document.getElementById('listModal');
            
            if (e.target === comicModal) {
                hideComicModal();
            }
            if (e.target === listModal) {
                hideListModal();
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        document.getElementById('newListName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addReadingList();
            }
        });

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'n' && currentTab === 'collection') {
                e.preventDefault();
                showComicModal();
            }
            
            if (e.key === 'Escape') {
                hideComicModal();
                hideListModal();
            }
        });

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateScrollButtons() {
            const scrollButtons = document.querySelector('.scroll-buttons');
            const upBtn = document.querySelector('.scroll-btn[onclick="scrollToTop()"]');
            const downBtn = document.querySelector('.scroll-btn[onclick="scrollToBottom()"]');
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollHeight = document.documentElement.scrollHeight;
            const clientHeight = window.innerHeight;
            
            const showUp = scrollTop > 300;
            const showDown = scrollTop < (scrollHeight - clientHeight - 300);
            
            if (showUp || showDown) {
                scrollButtons.classList.add('visible');
                upBtn.style.display = showUp ? 'flex' : 'none';
                downBtn.style.display = showDown ? 'flex' : 'none';
            } else {
                scrollButtons.classList.remove('visible');
            }
        }

        // –°–ª—É—à–∞—Ç–µ–ª—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        window.addEventListener('scroll', updateScrollButtons);
        window.addEventListener('resize', updateScrollButtons);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É "–°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è"
            currentTab = 'reading-lists';
            
            updateTabIndicator();
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è, –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π
            if (readingLists.length > 0) {
                expandedLists.add(readingLists[0]);
            }
            
            renderReadingLists();
            
            const sortSelect = document.querySelector('#collection .sort-select');
            if (sortSelect) {
                sortSelect.value = currentSort;
            }
            
            const viewButtons = document.querySelector('#collection .view-toggle');
            if (viewButtons) {
                Array.from(viewButtons.children).forEach(btn => btn.classList.remove('active'));
                if (currentView === 'list') {
                    viewButtons.children[0].classList.add('active');
                } else {
                    viewButtons.children[1].classList.add('active');
                }
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateTabIndicator();
        
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É "–°–ø–∏—Å–∫–∏ —á—Ç–µ–Ω–∏—è" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        if (readingLists.length > 0) {
            expandedLists.add(readingLists[0]);
        }
        renderReadingLists();

        // --- –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ---
        function wrapSelection(textareaId, before, after) {
            const textarea = document.getElementById(textareaId);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const value = textarea.value;
            if (start !== end) {
                const selected = value.substring(start, end);
                textarea.value = value.substring(0, start) + before + selected + after + value.substring(end);
                textarea.focus();
                textarea.selectionStart = start + before.length;
                textarea.selectionEnd = end + before.length;
            } else {
                // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–¥–µ–ª–µ–Ω–æ, –≤—Å—Ç–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω
                textarea.value = value.substring(0, start) + before + after + value.substring(end);
                textarea.focus();
                textarea.selectionStart = textarea.selectionEnd = start + before.length;
            }
        }
        // --- –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ –∏ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–≥–æ ---
        document.getElementById('comicContent').addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'b') {
                e.preventDefault();
                wrapSelection('comicContent', '**', '**');
            }
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 't') {
                e.preventDefault();
                wrapSelection('comicContent', '~~', '~~');
            }
        });
        // --- –ü–∞—Ä—Å–µ—Ä —Ä–∞–∑–º–µ—Ç–∫–∏ –¥–ª—è comicContent ---
        function parseComicContent(content) {
            if (!content) return '';
            // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º < –∏ >
            content = content.replace(/</g, '&lt;').replace(/>/g, '&gt;');
            // –ñ–∏—Ä–Ω—ã–π: **—Ç–µ–∫—Å—Ç**
            content = content.replace(/\*\*(.+?)\*\*/g, '<b>$1</b>');
            // –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π: ~~—Ç–µ–∫—Å—Ç~~
            content = content.replace(/~~(.+?)~~/g, '<span style="opacity:0.5">$1</span>');
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è—Ç—å –∂–∏—Ä–Ω—ã–º –≤—Å—ë, —á—Ç–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å # –∏ –¥–æ –ø—Ä–æ–±–µ–ª–∞ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Å—Ç—Ä–æ–∫–∏, –µ—Å–ª–∏ –Ω–µ –≤–Ω—É—Ç—Ä–∏ **...**
            content = content.replace(/(^|\s)(#\S+)/g, function(match, p1, p2) {
                // –ù–µ –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å, –µ—Å–ª–∏ —É–∂–µ –≤–Ω—É—Ç—Ä–∏ <b>...</b>
                if (p1.match(/<b>$/)) return match;
                return p1 + '<b>' + p2 + '</b>';
            });
            // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –≤ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ
            content = content.replace(/(https?:\/\/[\w\-._~:/?#[\]@!$&'()*+,;=%]+)/g, '<a href="$1" target="_blank">$1</a>');
            return content;
        }



        function setReadingListsMode(mode) {
            readingListsMode = mode;
            localStorage.setItem('marvel-reading-lists-mode', mode);
            if (mode === 'double') {
                if (!openedLists || openedLists.length < 2) {
                    openedLists = readingLists.slice(0, 2);
                    localStorage.setItem('marvel-opened-lists', JSON.stringify(openedLists));
                }
            } else {
                if (!openedLists || openedLists.length === 0) {
                    openedLists = [readingLists[0]];
                    localStorage.setItem('marvel-opened-lists', JSON.stringify(openedLists));
                }
            }
            renderReadingLists();
        }
        function setOpenedList(listName, pos) {
            if (readingListsMode === 'double') {
                if (pos === 0) {
                    openedLists[0] = listName;
                } else {
                    openedLists[1] = listName;
                }
                // –ù–µ –¥–æ–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–ø–∏—Å–∫–æ–≤
                if (openedLists[0] === openedLists[1]) {
                    openedLists[1] = readingLists.find(l => l !== openedLists[0]) || openedLists[0];
                }
            } else {
                openedLists = [listName];
            }
            localStorage.setItem('marvel-opened-lists', JSON.stringify(openedLists));
            renderReadingLists();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–ø–∏—Å–∫–∞
        function setListSortMode(listName, mode) {
            listSortModes[listName] = mode;
            saveData();
            renderReadingLists();
        }

        // --- MOBILE: –°–í–ï–†–¢–´–í–ê–ù–ò–ï –°–ü–ò–°–ö–û–í ---
        let readingListsCollapsed = true;
        function updateReadingListsMobileToggle() {
            const isMobile = window.innerWidth <= 768;
            const btn = document.getElementById('readingListsToggleBtn');
            const grid = document.getElementById('readingListsGrid');
            if (isMobile) {
                btn.style.display = 'flex';
                if (readingListsCollapsed) {
                    grid.classList.remove('mobile-visible');
                    document.getElementById('readingListsToggleIcon').textContent = '‚ò∞';
                    document.getElementById('readingListsToggleText').textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–∫–∏';
                } else {
                    grid.classList.add('mobile-visible');
                    document.getElementById('readingListsToggleIcon').textContent = '‚ñ≤';
                    document.getElementById('readingListsToggleText').textContent = '–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–∫–∏';
                }
            } else {
                btn.style.display = 'none';
                grid.classList.remove('mobile-visible');
            }
        }
        document.getElementById('readingListsToggleBtn').addEventListener('click', function() {
            readingListsCollapsed = !readingListsCollapsed;
            updateReadingListsMobileToggle();
        });
        window.addEventListener('resize', updateReadingListsMobileToggle);
        document.addEventListener('DOMContentLoaded', updateReadingListsMobileToggle);

        // --- MOBILE: –û–¢–ö–õ–Æ–ß–ï–ù–ò–ï DOUBLE-–†–ï–ñ–ò–ú–ê ---
        function enforceSingleListModeOnMobile() {
            if (window.innerWidth <= 768) {
                readingListsMode = 'single';
                localStorage.setItem('marvel-reading-lists-mode', 'single');
                document.getElementById('modeSingleBtn').classList.add('active');
                document.getElementById('modeDoubleBtn').classList.remove('active');
                // –°–∫—Ä—ã—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞
                document.getElementById('globalReadingListToggle').style.display = 'none';
            }
        }
        window.addEventListener('resize', enforceSingleListModeOnMobile);
        document.addEventListener('DOMContentLoaded', enforceSingleListModeOnMobile);

        // --- –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø renderReadingListContent –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ---
        function renderSingleReadingListContent(listName, colIdx) {
            if (!listName) return '';
            const listComics = getSortedComicsForList(listName);
            const viewMode = listViewModes[listName] || 'list';
            const sortMode = listSortModes[listName] || 'years';
            const isMobile = window.innerWidth <= 768;
            return `
                <div class="reading-list-content active" style="">
                    <div class="reading-list-view-controls">
                        <h3 style="color: #f1f5f9; margin: 0; flex: 1;">${listName}</h3>
                        ${!isMobile ? `<button class="btn btn-secondary" onclick="exportReadingListToTxt('${listName}')" title="–≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –≤ TXT">üìÑ</button>` : ''}
                        <div class="reading-list-sort-toggle">
                            <button class="${sortMode === 'years' ? 'active' : ''}" onclick="setListSortMode('${listName}', 'years')">–ü–æ –≥–æ–¥–∞–º</button>
                            <button class="${sortMode === 'end' ? 'active' : ''}" onclick="setListSortMode('${listName}', 'end')">–í –∫–æ–Ω–µ—Ü</button>
                        </div>
                        <div class="reading-list-view-toggle">
                            <button class="${viewMode === 'list' ? 'active' : ''}" onclick="toggleReadingListView('${listName}', 'list')">üìã</button>
                            <button class="${viewMode === 'grid' ? 'active' : ''}" onclick="toggleReadingListView('${listName}', 'grid')">üî≤</button>
                        </div>
                    </div>
                    ${listComics.length === 0 ? 
                        '<div style="text-align: center; color: #94a3b8; padding: 40px;">–ö–æ–º–∏–∫—Å–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç</div>' :
                        (viewMode === 'grid' ? 
                            `<div class="reading-list-grid-view">${listComics.map((comic, index) => createReadingListGridItem(comic, listName, index)).join('')}</div>` :
                            listComics.map(comic => createReadingListItem(comic, listName)).join('')
                        )
                    }
                </div>
            `;
        }

        // --- –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø createReadingListItem –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ---
        function createReadingListItem(comic, listName) {
            const isMobile = window.innerWidth <= 768;
            return `
                <div class="reading-list-item ${comic.isRead ? 'read' : ''} ${isMobile && comic._mobileProgressExpanded ? 'mobile-progress-expanded' : ''}" data-comic-id="${comic.id}" data-list="${listName}" ${isMobile ? `ontouchstart="toggleMobileProgressBlocks(${comic.id})" onclick="toggleMobileProgressBlocks(${comic.id})"` : ''}>
                    <div class="reading-list-comic-info">
                        ${comic.cover ? 
                            `<img src="${comic.cover}" alt="${comic.title}" class="reading-list-image">` :
                            '<div class="reading-list-image">üìñ</div>'
                        }
                        <div class="reading-list-text-info">
                            <div class="reading-list-main-info">
                                <div class="reading-list-title-text">${comic.title}</div>
                                <div class="reading-list-years">${comic.years}</div>
                            </div>
                            <div class="reading-list-progress">
                                <div class="reading-list-progress-blocks${isMobile && comic._mobileProgressExpanded ? ' mobile-expanded' : ''}">
                                    ${createProgressBlocks(comic)}
                                </div>
                            </div>
                            ${isMobile ? `<div class='reading-list-content-text'>${parseComicContent(comic.content)}</div>` : ''}
                        </div>
                        <div class="drag-handle">‚ãÆ‚ãÆ</div>
                    </div>
                    ${!isMobile ? `<div class='reading-list-content-text'>${parseComicContent(comic.content)}</div>` : ''}
                    <div class="comic-actions">
                         <button class="action-btn bookmark-action-btn ${currentlyReading[listName] === comic.id ? 'active' : ''}" 
                            onclick="toggleCurrentlyReading(${comic.id}, '${listName}')" 
                            title="${currentlyReading[listName] === comic.id ? '–°–Ω—è—Ç—å –∑–∞–∫–ª–∞–¥–∫—É' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ —á–∏—Ç–∞–µ–º—ã–π'}">‚≠ê</button>
                          <button class="action-btn edit-btn" onclick="showComicModal(${JSON.stringify(comic).replace(/\"/g, '&quot;')})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                         <button class="action-btn copy-btn" onclick="copyComic(${comic.id})" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                         <button class="action-btn read-btn" onclick="toggleReadStatus(${comic.id})" title="${comic.isRead ? '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π' : '–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π'}">${comic.isRead ? 'üìñ' : '‚úÖ'}</button>
                         <button class="action-btn delete-btn" onclick="deleteComic(${comic.id})" title="–£–¥–∞–ª–∏—Ç—å">‚úï</button>
                    </div>
                </div>
            `;
        }

        // --- –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø createProgressBlocks –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö ---
        function createProgressBlocks(comic) {
            const blocks = [];
            const totalIssues = Math.min(comic.totalIssues, 100);
            const isMobile = window.innerWidth <= 768;
            const expanded = comic._mobileProgressExpanded;
            const blockWidth = totalIssues <= 10 ? '40px' : 
                              totalIssues <= 20 ? '35px' : 
                              totalIssues <= 50 ? '30px' : '25px';
            if (!isMobile || expanded) {
                for (let i = 1; i <= totalIssues; i++) {
                    let blockClass = 'progress-block';
                    if (i <= comic.readIssues) {
                        blockClass += ' read';
                    }
                    blocks.push(`
                        <div class="${blockClass}" 
                             data-comic-id="${comic.id}" 
                             data-issue="${i}"
                             onclick="updateComicProgressFromBlock(${comic.id}, ${i})"
                             title="–í—ã–ø—É—Å–∫ ${i}"
                             style="width: ${blockWidth};">
                            ${i}
                        </div>
                    `);
                }
                if (comic.totalIssues > 100) {
                    blocks.push(`
                        <div class="progress-block" style="background: rgba(100, 116, 139, 0.5); cursor: default; width: ${blockWidth};" title="–í—Å–µ–≥–æ –≤—ã–ø—É—Å–∫–æ–≤: ${comic.totalIssues}">
                            +${comic.totalIssues - 100}
                        </div>
                    `);
                }
            }
            return blocks.join('');
        }

        // --- –ú–û–î–ò–§–ò–ö–ê–¶–ò–Ø toggleMobileProgressBlocks ---
        function toggleMobileProgressBlocks(comicId) {
            const comic = comicsData.find(c => c.id === comicId);
            if (comic) {
                comic._mobileProgressExpanded = !comic._mobileProgressExpanded;
                renderCollection();
                renderReadingListContent();
            }
        }
    </script>
</body>
</html>
